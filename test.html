<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <style>
        #lyric {
            width: 400px;
            height: 400px;
            position: relative;
            margin: 0 auto;
            background-color: rgba(218, 218, 218, 0.8);
            white-space: pre-line;
            overflow: auto;
        }
    </style>
</head>

<body>

    <div id='lyric'></div>
    <script>
        var player = function(health, damage, armor, speed) {
            this.health = health || 100;
            this.damage = damage || 10;
            this.armor = armor || 10;
            this.speed = speed || 1;
        }

        player.prototype = {
            restore: function() {
                this.health += 50;
                console.log(this.health);
            }
        }
        var player = new player();

        var monster = function(health, damage, armor, speed) {
            this.health = health || 100;
            this.damage = damage || 15;
            this.armor = armor || 1;
            this.speed = speed || 1;
        }
        var monster = new monster();

        var ele = document.getElementById("lyric");
        Battle(player, monster, ele);

        function Battle(player, monster, ele) {
            var timep = 0,
                timem = 1000,
                tp, tm;
            if (player.speed < monster.speed) {
                timep = 1000;
                timem = 0;
            }
            setTimeout(() => {
                tp = setInterval(() => {
                    pBattle(player, monster, ele);
                }, 2000);
            }, timep);
            setTimeout(() => {
                tm = setInterval(() => {
                    mBattle(player, monster, ele);
                }, 2000);
            }, timem);

            function pBattle(player, monster, ele) {
                monster.health -= player.damage - monster.armor;
                if (monster.health < 0) monster.health = 0;

                ele.appendChild(document.createTextNode("你对怪物造成了" + (player.damage - monster.armor) + "点伤害，怪物当前剩余" + monster.health + "点血量\n"));
                if (monster.health == 0) {
                    window.clearInterval(tp);
                    window.clearInterval(tm);
                    ele.appendChild(document.createTextNode("你打败了怪物\n"));
                }
            }

            function mBattle(player, monster, ele) {
                player.health -= monster.damage - player.armor;
                if (player.health < 0) player.health = 0;
                ele.appendChild(document.createTextNode("怪物对你造成了" + (monster.damage - player.armor) + "点伤害，你当前剩余" + player.health + "点血量\n"));
                if (player.health == 0) {
                    window.clearInterval(tp);
                    window.clearInterval(tm);
                    ele.appendChild(document.createTextNode("怪物打败了你\n"));
                }
            }
        }
    </script>


</body>

</html>